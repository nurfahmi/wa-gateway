<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - WhatsApp Gateway</title>
  <link rel="stylesheet" href="/css/output.css">
</head>
<body class="bg-gray-50">
  <%- include('../partials/header', { user }) %>
  <div class="flex">
    <%- include('../partials/sidebar') %>
    <main class="flex-1 p-8">
      <div class="mb-6">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">Messages</h2>
        <p class="text-gray-600">View and manage all your WhatsApp messages</p>
      </div>
      
      <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <% if (messages.length === 0) { %>
          <div class="p-12 text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
            <p class="mt-4 text-sm text-gray-600">No messages yet.</p>
          </div>
        <% } else { %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Direction</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">From</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">To</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Content</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% messages.forEach(msg => { %>
                  <tr class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <% if (msg.direction === 'incoming') { %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-600 text-white">
                          <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                          </svg>
                          Incoming
                        </span>
                      <% } else { %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-500 text-white">
                          <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l4-4m0 0l4 4m-4-4v18" />
                          </svg>
                          Outgoing
                        </span>
                      <% } %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= msg.from_number || 'N/A' %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= msg.to_number || 'N/A' %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 capitalize"><%= msg.message_type %></td>
                    <td class="px-6 py-4 text-sm text-gray-600 max-w-xs truncate"><%= msg.content ? msg.content.substring(0, 50) : '[Media]' %></td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-600 text-white capitalize"><%= msg.status %></span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= new Date(msg.sent_at).toLocaleString() %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <% if (pagination.pages > 1) { %>
            <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
              <div class="text-sm text-gray-700">
                Showing page <%= Math.floor(pagination.offset / pagination.limit) + 1 %> of <%= pagination.pages %>
              </div>
              <div class="flex space-x-2">
                <% for (let i = 1; i <= pagination.pages; i++) { %>
                  <a href="/messages?limit=<%= pagination.limit %>&offset=<%= (i - 1) * pagination.limit %>" 
                     class="px-3 py-2 text-sm font-medium rounded-lg <%= (pagination.offset / pagination.limit + 1) === i ? 'bg-primary-600 text-white' : 'text-gray-700 bg-white border border-gray-300 hover:bg-gray-50' %> transition-colors duration-150">
                    <%= i %>
                  </a>
                <% } %>
              </div>
            </div>
          <% } %>
        <% } %>
      </div>
    </main>
  </div>
  <%- include('../partials/footer') %>
</body>
</html>

